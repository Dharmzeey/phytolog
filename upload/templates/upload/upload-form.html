{% extends 'base/base.html' %}
{% block title %}
<title>
  Upload Tree | Trees in UI
</title>
{% endblock %}
{% block content %}

<div class="form-container">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Upload Tree Information</h2>
      <p class="text-muted">Add a new tree to the database</p>
    </div>
    
    <form action="" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      
      {% for field in form %}
      <div class="form-group">
        <label for="{{ field.id_for_label }}" class="form-label">
          {{ field.label }}
          {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
        </label>
        
        {% if field.field.widget.input_type == 'textarea' %}
        <textarea name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-input" 
                  {% if field.field.required %}required{% endif %}
                  placeholder="{{ field.help_text|default:'' }}">{{ field.value|default:'' }}</textarea>
        {% elif field.field.widget.input_type == 'select' %}
        <select name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-input"
                {% if field.field.required %}required{% endif %}>
          {% for choice in field.field.choices %}
          <option value="{{ choice.0 }}" {% if choice.0 == field.value %}selected{% endif %}>
            {{ choice.1 }}
          </option>
          {% endfor %}
        </select>
        {% elif field.field.widget.input_type == 'file' %}
        <input type="file" name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-input"
               {% if field.field.required %}required{% endif %}
               accept="image/*" />
        {% else %}
        <input type="{{ field.field.widget.input_type|default:'text' }}" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               class="form-input"
               value="{{ field.value|default:'' }}"
               {% if field.field.required %}required{% endif %}
               placeholder="{{ field.help_text|default:'' }}" />
        {% endif %}
        
        {% if field.errors %}
        <div class="error-message mt-2">
          {% for error in field.errors %}
          <p>{{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}
        
        {% if field.help_text %}
        <p class="text-muted text-sm mt-2">{{ field.help_text }}</p>
        {% endif %}
      </div>
      {% endfor %}
      
      <div class="flex gap-4 mt-8">
        <button type="submit" class="btn btn-primary">Upload Tree</button>
        <a href="{% url 'home:home' %}" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

<script>
  // Auto-populate coordinates
  const coordinatesField = document.getElementById("id_coordinates");
  const latitudeField = document.getElementById("id_latitude");
  const longitudeField = document.getElementById("id_longitude");
  
  if (coordinatesField && latitudeField && longitudeField) {
    coordinatesField.readOnly = true;
    latitudeField.readOnly = true;
    longitudeField.readOnly = true;
    
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        
        coordinatesField.value = lat + ',' + lng;
        latitudeField.value = lat;
        longitudeField.value = lng;
      });
    }
  }
</script>

{% endblock %}